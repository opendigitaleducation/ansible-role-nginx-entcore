# NGINX Variables

nginx_user: "www-data"
nginx_worker_processes: 'auto'
nginx_worker_rlimit_nofile: 100480
nginx_official_repo: true
# A list of directives for the events section.
nginx_events_params:
 - worker_connections 8192
 - use epoll
 - multi_accept on

# A list of hashs that define the servers for nginx,
# as with http parameters. Any valid server parameters
# can be defined here.
nginx_sites:
 server-status:
     - listen 80
     - server_name localhost
     - location /nginx_status {
         stub_status on;
         access_log off;
         allow 127.0.0.1;
         deny all;
       }
# nginx_remove_sites: ['ent-ha']
ent_sites:
  ecole:
    server_name: 'ecole.test.fr'
    nodes:
      - '172.128.20.22'
      - '172.128.20.23'
    ssl_certificate: '/etc/ssl/star.test.fr/crt'
    ssl_certificate_key: '/etc/ssl/star.test.fr/key'
    upstream_suffix: 'ecole'
    upstreams: "{{ default_apps }}"
    document_root: '/var/www/web-education'
    etherpad_host: '172.128.20.27'
    client_max_body_size: '150M'
    cache: 'one-test'
  college:
    server_name: 'college.test.fr'
    nodes:
      - '172.128.20.22'
      - '172.128.20.23'
    ssl_certificate: '/etc/ssl/star.test.fr/crt'
    ssl_certificate_key: '/etc/ssl/star.test.fr/key'
    upstream_suffix: 'college'
    upstreams: "{{ default_apps }}"
    document_root: '/var/www/web-education'
    etherpad_host: '172.128.20.27'
    client_max_body_size: '150M'
    cache: 'one-test'

nginx_cache_dir:
  - '/var/www/cache/neo-test'
  - '/var/www/cache/one-test'
  - '/var/www/cache/test'

nginx_configs:
  proxy:
      - proxy_set_header X-Real-IP  $remote_addr
      - proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for
  gzip:
      - gzip on
      - gzip_disable msie6
  security:
      - ssl_dhparam /etc/ssl/certs/dhparam.pem
  caches:
      - proxy_cache_path /var/www/cache/neo-test levels=1:2 keys_zone=neo-test:10m max_size=100m inactive=1y
      - proxy_cache_path /var/www/cache/one-test levels=1:2 keys_zone=one-test:10m max_size=100m inactive=1y
      - proxy_cache_path /var/www/cache/test levels=1:2 keys_zone=test:10m max_size=100m inactive=1y